# 数据分析页面预算展示功能测试指南

## 功能概述

在数据分析页面的分类统计卡片中，为一级分类展示预算执行情况，包括：
- 预算金额（根据时间范围自动计算）
- 剩余/超支金额
- 预算使用进度条（颜色根据状态变化）

## 测试前准备

### 1. 创建测试数据

确保数据库中有以下数据：

1. **家庭组**：至少一个家庭组
2. **分类**：
   - 一级分类：餐饮、交通、购物等
   - 子分类：早餐、午餐、晚餐（餐饮的子分类）
3. **年度预算**：
   - 为"餐饮"设置年度预算 36000 元
   - 为"交通"设置年度预算 6000 元
4. **交易记录**：
   - 本月餐饮支出：2400 元（包含早餐、午餐、晚餐）
   - 本月交通支出：320 元

### 2. 导航到数据分析页面

1. 启动应用
2. 点击底部导航栏的"分析"标签
3. 找到"分类统计"卡片

## 测试用例

### 测试用例 1：本月时间范围 - 正常状态

**前置条件**：
- 时间范围选择"本月"
- 餐饮分类有年度预算 36000 元
- 本月餐饮实际支出 2400 元（80%）

**预期结果**：
```
▼ 🍔 餐饮                    ¥2,400
   3笔 · 80.0%

   预算 ¥3,000/月  剩余 ¥600
   [████████░░] 80%
```

**验证点**：
- ✅ 显示月度预算：¥3,000/月（36000 ÷ 12）
- ✅ 显示剩余金额：¥600（3000 - 2400）
- ✅ 进度条为橙色（80% 处于预警状态）
- ✅ 百分比显示：80%

### 测试用例 2：本月时间范围 - 超支状态

**前置条件**：
- 时间范围选择"本月"
- 交通分类有年度预算 6000 元
- 本月交通实际支出 600 元（120%）

**预期结果**：
```
▼ 🚗 交通                    ¥600
   5笔 · 120.0%

   预算 ¥500/月  超支 ¥100 ⚠️
   [██████████] 120%
```

**验证点**：
- ✅ 显示月度预算：¥500/月（6000 ÷ 12）
- ✅ 显示超支金额：超支 ¥100（红色）
- ✅ 显示警告图标 ⚠️
- ✅ 进度条为红色（≥ 100%）
- ✅ 百分比显示：120%

### 测试用例 3：本季度时间范围

**前置条件**：
- 时间范围选择"本季度"
- 餐饮分类有年度预算 36000 元
- 本季度餐饮实际支出 7200 元（80%）

**预期结果**：
```
▼ 🍔 餐饮                    ¥7,200

   预算 ¥9,000/季  剩余 ¥1,800
   [████████░░] 80%
```

**验证点**：
- ✅ 显示季度预算：¥9,000/季（36000 ÷ 4）
- ✅ 文案显示"/季"而不是"/月"

### 测试用例 4：本年时间范围

**前置条件**：
- 时间范围选择"本年"
- 餐饮分类有年度预算 36000 元
- 本年餐饮实际支出 28800 元（80%）

**预期结果**：
```
▼ 🍔 餐饮                    ¥28,800

   预算 ¥36,000/年  剩余 ¥7,200
   [████████░░] 80%
```

**验证点**：
- ✅ 显示年度预算：¥36,000/年
- ✅ 文案显示"/年"

### 测试用例 5：无预算的分类

**前置条件**：
- 购物分类没有设置预算
- 本月购物支出 1500 元

**预期结果**：
```
▼ 🛍️ 购物                    ¥1,500
   5笔 · 15.0%

   [设置预算]
```

**验证点**：
- ✅ 不显示预算信息和进度条
- ✅ 显示"设置预算"按钮
- ✅ 点击按钮显示提示（功能即将上线）

### 测试用例 6：子分类不显示预算

**前置条件**：
- 展开餐饮分类，查看子分类（早餐、午餐、晚餐）

**预期结果**：
```
▼ 🍔 餐饮                    ¥2,400
   预算 ¥3,000/月  剩余 ¥600
   [████████░░] 80%

   ▶ 🌅 早餐                   ¥800
      1笔 · 26.7%

   ▶ 🌞 午餐                 ¥1,000
      1笔 · 33.3%
```

**验证点**：
- ✅ 子分类不显示预算信息
- ✅ 子分类不显示进度条
- ✅ 子分类的支出已计入父分类的实际支出

### 测试用例 7：自定义/全部时间范围

**前置条件**：
- 时间范围选择"自定义"或"全部"

**预期结果**：
- ✅ 不显示预算信息
- ✅ 不显示进度条
- ✅ 不显示"设置预算"按钮

### 测试用例 8：响应式设计

**测试步骤**：
1. 在不同屏幕尺寸下测试（手机、平板、桌面）
2. 调整窗口大小

**预期结果**：
- ✅ 小屏幕（< 360px）：字体自动缩小
- ✅ 进度条自适应宽度
- ✅ 布局不换行、不重叠

### 测试用例 9：预算状态颜色

**测试不同使用百分比的颜色**：

| 使用百分比 | 进度条颜色 | 状态 |
|-----------|----------|------|
| 0% - 79% | 绿色 | 正常 |
| 80% - 99% | 橙色 | 预警 |
| ≥ 100% | 红色 | 超支 |

**验证点**：
- ✅ 颜色正确对应状态
- ✅ 百分比文字颜色与进度条一致

## 性能测试

### 测试用例 10：加载性能

**测试步骤**：
1. 切换到数据分析页面
2. 观察分类统计卡片的加载时间

**预期结果**：
- ✅ 加载时间 < 1 秒
- ✅ 显示加载指示器
- ✅ 预算数据与统计数据同时加载（一次查询）

### 测试用例 11：切换时间范围

**测试步骤**：
1. 在"本月"、"本季度"、"本年"之间切换
2. 观察预算金额和文案的变化

**预期结果**：
- ✅ 预算金额正确计算
- ✅ 时间范围文案正确显示（/月、/季、/年）
- ✅ 切换流畅，无卡顿

## 边界情况测试

### 测试用例 12：预算为 0

**前置条件**：
- 分类有预算，但预算金额为 0

**预期结果**：
- ✅ 不显示预算信息（视为无预算）

### 测试用例 13：实际支出为 0

**前置条件**：
- 分类有预算，但本月无支出

**预期结果**：
```
▼ 🍔 餐饮                    ¥0
   0笔 · 0.0%

   预算 ¥3,000/月  剩余 ¥3,000
   [░░░░░░░░░░] 0%
```

**验证点**：
- ✅ 进度条为空（绿色背景）
- ✅ 显示剩余金额等于预算金额

### 测试用例 14：跨年预算

**前置条件**：
- 当前年份为 2026 年
- 查看 2025 年的数据

**预期结果**：
- ✅ 不显示预算信息（预算按年份隔离）

## 回归测试

### 测试用例 15：原有功能不受影响

**验证点**：
- ✅ 展开/收起子分类功能正常
- ✅ 点击查看流水明细功能正常
- ✅ 分类统计金额计算正确
- ✅ 收入/支出切换功能正常

## 已知问题

无

## 测试结论

- [ ] 所有测试用例通过
- [ ] 性能符合预期
- [ ] 无回归问题
- [ ] 可以发布

## 测试环境

- Flutter 版本：
- 设备：macOS / iOS / Android
- 测试日期：
- 测试人员：
