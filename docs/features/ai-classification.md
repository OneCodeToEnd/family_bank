# AI智能分类

账清集成AI能力，使用大语言模型自动分类交易，提高记账效率。

## 支持的AI提供商

### 通义千问（Qwen）

阿里云的大语言模型：
- 中文理解能力强
- 响应速度快
- 价格实惠

### DeepSeek

DeepSeek的大语言模型：
- 推理能力强
- 分类准确度高
- 支持复杂场景

---

## 配置AI模型

### 获取API密钥

**通义千问：**
1. 访问 [阿里云百炼平台](https://bailian.console.aliyun.com/)
2. 创建应用并获取API Key
3. 确保账户有足够余额

**DeepSeek：**
1. 访问 [DeepSeek开放平台](https://platform.deepseek.com/)
2. 注册并获取API Key
3. 充值账户余额

### 添加模型配置

1. 进入"设置" → "AI设置"
2. 点击"添加模型配置"
3. 填写配置信息：
   - **提供商**：选择通义千问或DeepSeek
   - **模型名称**：选择具体模型
   - **API密钥**：输入获取的API Key
   - **自定义提示词**：可选，优化分类效果
4. 点击"测试连接"验证配置
5. 保存配置

!!! note "安全提示"
    API密钥会使用AES-256加密存储在本地数据库，不会上传到任何服务器。

---

## 使用AI分类

### 单笔分类

为单笔交易使用AI分类：

1. 在交易列表中选择未分类的交易
2. 点击"AI分类"按钮
3. 等待AI分析（通常1-2秒）
4. 查看AI建议的分类
5. 确认或修改分类

### 批量分类

为多笔交易批量分类：

1. 在交易列表中选择多笔未分类交易
2. 点击"批量AI分类"
3. 系统依次调用AI分析
4. 显示分类结果
5. 逐个确认或批量确认

### 导入时自动分类

配置导入时自动使用AI分类：

1. 进入"设置" → "AI设置"
2. 启用"导入时自动分类"
3. 设置置信度阈值
4. 导入账单时自动调用AI分类

---

## 分类结果

### 置信度

AI返回的分类结果包含置信度：

- **高置信度（≥80%）**：
  - 自动应用分类
  - 标记为"已确认"

- **中置信度（50-80%）**：
  - 建议分类
  - 需要用户确认

- **低置信度（<50%）**：
  - 仅作参考
  - 建议手动分类

### 分类依据

AI分析以下信息进行分类：
- **交易描述**：主要依据
- **交易对方**：商家或收款方
- **金额大小**：辅助判断
- **历史记录**：学习用户习惯

---

## 自定义提示词

### 默认提示词

系统使用预设的提示词模板：
```
你是一个专业的财务分类助手。请根据交易描述和交易对方，
从以下分类中选择最合适的一个：

[分类列表]

交易描述：{description}
交易对方：{counterparty}

请返回最合适的分类名称和置信度（0-100）。
```

### 自定义优化

可以自定义提示词以提高准确度：

**示例1 - 强调特定分类：**
```
特别注意：
- 外卖平台（美团、饿了么）应归类为"餐饮"
- 打车软件（滴滴、高德）应归类为"交通"
- 电商平台（淘宝、京东）应归类为"购物"
```

**示例2 - 添加个人习惯：**
```
用户习惯：
- 星巴克、瑞幸等咖啡店归类为"餐饮-饮料"
- 健身房、瑜伽馆归类为"娱乐-运动"
- 书店、Kindle归类为"教育-书籍"
```

---

## 自动学习

### 学习机制

系统会从您的分类行为中学习：

1. **记录修正**：记录您对AI分类的修正
2. **分析模式**：分析修正的规律
3. **优化规则**：自动生成关键词规则
4. **提高准确度**：减少未来的错误分类

### 学习效果

随着使用时间增长：
- 分类准确度逐步提高
- 需要手动修正的次数减少
- 关键词规则库更完善

---

## 成本控制

### API调用费用

AI分类需要调用API，会产生费用：
- 通义千问：约0.001元/次
- DeepSeek：约0.0005元/次

### 节省成本

**使用关键词规则：**
- 优先使用关键词匹配
- AI作为补充手段
- 减少API调用次数

**批量处理：**
- 积累一定数量后批量分类
- 避免频繁单次调用

**设置阈值：**
- 只对重要交易使用AI
- 小额交易使用规则匹配

---

## 查看日志

### HTTP日志

查看AI API调用日志：

1. 进入"设置" → "AI设置"
2. 点击"查看日志"
3. 查看：
   - 请求时间
   - 请求内容
   - 响应结果
   - 错误信息

### 调试问题

通过日志可以：
- 了解AI的分类依据
- 排查分类错误原因
- 优化提示词
- 检查API调用状态

---

## 故障排除

### API调用失败

**问题**：显示"API调用失败"错误

**解决方案**：
1. 检查API密钥是否正确
2. 确认账户余额充足
3. 验证网络连接正常
4. 查看HTTP日志了解详细错误

### 分类不准确

**问题**：AI返回的分类不符合预期

**解决方案**：
1. 自定义提示词，提供更多上下文
2. 手动修正后让系统学习
3. 添加关键词规则作为补充
4. 尝试切换到其他AI提供商

### 响应速度慢

**问题**：AI分类等待时间过长

**解决方案**：
1. 检查网络连接速度
2. 尝试切换到响应更快的模型
3. 使用批量分类而非单笔分类
4. 考虑在网络较好时进行分类

---

## 最佳实践

### 合理使用

- **优先规则匹配**：常见交易使用关键词规则
- **AI作为补充**：复杂或新类型交易使用AI
- **及时修正**：发现错误及时修正，帮助系统学习

### 提示词优化

- **明确分类标准**：在提示词中说明分类原则
- **提供示例**：给出典型交易的分类示例
- **强调重点**：突出容易混淆的分类

### 成本优化

- **设置阈值**：只对金额较大的交易使用AI
- **批量处理**：积累后批量分类
- **定期review**：检查分类效果，优化策略

---

## 隐私与安全

### 数据安全

- **本地存储**：API密钥加密存储在本地
- **不上传数据**：交易数据不会上传到我们的服务器
- **直接调用**：直接调用AI提供商API
- **可随时删除**：可随时删除API配置

### API密钥保护

- 使用AES-256加密
- 仅在调用时解密
- 不会显示在界面上
- 不会记录在日志中

---

## 相关功能

- [分类系统](categories.md) - 管理分类和规则
- [交易记录](transactions.md) - 查看和编辑交易
- [账单导入](bill-import.md) - 导入时自动分类