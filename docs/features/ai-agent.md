# AI智能问答

账清集成AI Agent能力，支持通过自然语言对话查询和分析账务数据。

## 功能概览

AI智能问答基于ReAct（推理+行动）模式，Agent可以：

- **自然语言查询**：用日常语言提问，如"这个月花了多少钱"
- **数据分析**：自动编写SQL查询数据库，返回分析结果
- **多轮对话**：支持上下文连续对话
- **记忆学习**：记住用户偏好，持续优化回答质量

---

## 使用方式

### 进入对话

1. 在应用底部导航栏点击"问答"图标
2. 进入对话界面，输入问题即可开始

### 快捷提问

首次进入对话时，界面会显示预设的快捷提问按钮，点击即可快速发送常用问题。

管理快捷提问：

1. 进入"设置" → "AI设置" → "快捷提问管理"
2. 点击"+"添加常用问题
3. 长按拖拽调整顺序
4. 左滑删除不需要的问题

### 提问示例

**基础查询：**
- "这个月的总支出是多少？"
- "最近一周的餐饮消费有哪些？"
- "上个月收入最高的一天是哪天？"

**数据分析：**
- "对比最近三个月的支出趋势"
- "哪个分类花费最多？"
- "今年和去年同期的消费对比"

**复杂问题：**
- "帮我分析一下消费习惯"
- "哪些交易对手方消费最频繁？"

---

## 会话管理

### 多会话支持

- 点击右上角"历史"图标查看所有会话
- 点击"+"创建新会话
- 长按会话可置顶或删除
- 系统自动为会话生成标题

### 会话持久化

所有对话记录保存在本地数据库，重启应用后可继续之前的对话。

---

## Agent工具

AI Agent在回答问题时会自动调用以下工具：

| 工具 | 功能 | 说明 |
|------|------|------|
| 获取表列表 | 查看数据库业务表 | 了解可查询的数据范围 |
| 获取表结构 | 查看表的DDL定义 | 理解字段含义和类型 |
| 执行SQL查询 | 执行只读SQL | 查询数据并返回结果 |
| 保存记忆 | 记录用户偏好 | 持久化用户的喜好和习惯 |

对话中可以展开"工具调用"卡片，查看Agent的推理过程和SQL查询。

---

## 反馈与记忆

### 消息反馈

每条AI回复下方有点赞/点踩按钮：

- **点赞**：系统自动提取回答要点，保存为正向记忆
- **点踩**：可输入不满意的原因，保存为改进记忆

### 记忆管理

进入"设置" → "AI设置" → "Agent记忆管理"：

- 查看所有已保存的记忆
- 按类型分类显示（喜好/不喜欢/备注）
- 可删除单条或清空全部记忆

Agent会在后续对话中参考这些记忆，提供更符合偏好的回答。

---

## 安全机制

### 数据安全

- **只读查询**：Agent只能执行SELECT查询，无法修改数据
- **表访问控制**：敏感表（AI模型配置、邮箱配置等）对Agent不可见
- **SQL安全校验**：多层校验防止SQL注入和危险操作
- **结果限制**：单次查询最多返回50行、4000字符

### 隐私保护

- 对话数据仅存储在本地
- API密钥加密存储
- 不会将账务数据上传到第三方服务器

---

## 配置说明

AI智能问答复用AI分类的模型配置：

1. 进入"设置" → "AI设置"
2. 确保已配置并激活AI模型（DeepSeek或通义千问）
3. 返回主界面即可使用问答功能

!!! tip "推荐模型"
    建议使用DeepSeek系列模型，推理能力更强，适合数据分析场景。

---

## 故障排除

### Agent无响应

1. 检查AI模型是否已配置并激活
2. 确认API密钥有效且余额充足
3. 检查网络连接

### 查询结果不准确

1. 尝试更具体的提问方式
2. 通过点踩反馈帮助Agent改进
3. 在记忆管理中添加偏好说明

---

## 相关功能

- [AI智能分类](ai-classification.md) - AI模型配置和分类功能
- [数据分析](analysis.md) - 图表化数据分析
