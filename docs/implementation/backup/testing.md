# 备份功能测试指南

## 快速测试步骤

### 1. 启动应用

```bash
flutter run
```

### 2. 进入备份管理

导航路径：设置 → 数据管理 → 备份管理

### 3. 测试基础功能

#### 测试 1：创建备份
1. 点击「立即备份」按钮
2. 等待备份完成
3. 检查「备份历史」列表中是否出现新备份
4. 检查「最后备份」时间是否更新

**预期结果：**
- 显示「备份创建成功」提示
- 备份历史列表增加一条记录
- 最后备份时间更新

#### 测试 2：导出备份
1. 点击「导出备份」按钮
2. 系统打开分享界面
3. 选择一个分享方式（如 AirDrop、微信）
4. 确认文件已发送

**预期结果：**
- 创建新备份
- 打开系统分享界面
- 可以选择分享目标

#### 测试 3：导入备份
1. 准备一个备份文件（通过导出获得）
2. 点击「导入备份」按钮
3. 确认警告对话框
4. 选择备份文件
5. 等待导入完成

**预期结果：**
- 显示警告对话框
- 打开文件选择器
- 导入成功后显示提示

#### 测试 4：恢复备份
1. 在备份历史列表中选择一个备份
2. 点击右侧菜单按钮
3. 选择「恢复」
4. 确认警告对话框
5. 等待恢复完成

**预期结果：**
- 显示警告对话框
- 恢复成功后显示提示

#### 测试 5：删除备份
1. 在备份历史列表中选择一个备份
2. 点击右侧菜单按钮
3. 选择「删除」
4. 确认对话框
5. 检查备份是否从列表中移除

**预期结果：**
- 显示确认对话框
- 备份从列表中移除
- 显示「备份已删除」提示

#### 测试 6：自动备份设置
1. 启用「自动备份」开关
2. 点击「备份频率」
3. 选择一个频率（如 3 天）
4. 点击「保留备份数」
5. 选择一个数量（如 5 个）

**预期结果：**
- 设置成功保存
- 界面显示更新后的设置

### 4. 测试自动备份

#### 测试 7：自动备份触发
1. 启用自动备份
2. 设置备份频率为 1 天
3. 等待超过 1 天（或修改系统时间）
4. 重启应用
5. 检查是否自动创建了新备份

**预期结果：**
- 应用启动时自动创建备份
- 备份历史列表增加新记录

#### 测试 8：自动清理旧备份
1. 创建多个备份（超过保留数量）
2. 设置保留备份数为 3
3. 创建新备份
4. 检查是否只保留最近 3 个备份

**预期结果：**
- 旧备份自动删除
- 只保留最近 N 个备份

## 异常测试

### 测试 9：导入无效文件
1. 准备一个非数据库文件（如 .txt）
2. 重命名为 .db
3. 尝试导入
4. 检查错误提示

**预期结果：**
- 显示「备份文件无效或已损坏」错误

### 测试 10：磁盘空间不足
1. 填满设备存储空间
2. 尝试创建备份
3. 检查错误提示

**预期结果：**
- 显示磁盘空间不足错误

### 测试 11：恢复过程中断
1. 开始恢复备份
2. 立即关闭应用（模拟中断）
3. 重新打开应用
4. 检查数据是否完整

**预期结果：**
- 数据保持原状（回滚机制生效）

## 性能测试

### 测试 12：大数据量备份
1. 创建大量测试数据（1000+ 条交易）
2. 创建备份
3. 测量备份时间
4. 检查备份文件大小

**预期结果：**
- 备份在合理时间内完成（< 5 秒）
- 文件大小合理（< 10MB）

### 测试 13：多个备份管理
1. 创建 20 个备份
2. 检查列表加载速度
3. 测试删除操作
4. 测试导出操作

**预期结果：**
- 列表流畅加载
- 操作响应及时

## 多设备测试

### 测试 14：跨设备数据迁移
1. 在设备 A 上创建测试数据
2. 导出备份
3. 通过 AirDrop 发送到设备 B
4. 在设备 B 上导入备份
5. 验证数据完整性

**预期结果：**
- 所有数据正确迁移
- 无数据丢失

## 检查清单

- [ ] 创建备份功能正常
- [ ] 导出备份功能正常
- [ ] 导入备份功能正常
- [ ] 恢复备份功能正常
- [ ] 删除备份功能正常
- [ ] 自动备份设置正常
- [ ] 自动备份触发正常
- [ ] 自动清理旧备份正常
- [ ] 备份历史显示正常
- [ ] 错误提示清晰准确
- [ ] 界面响应流畅
- [ ] 跨设备迁移正常

## 已知问题

目前没有已知问题。

## 测试环境

- Flutter 版本：3.6.0+
- 测试平台：iOS / Android / macOS
- 测试设备：iPhone / iPad / Android 手机 / Mac

## 测试报告模板

```
测试日期：____年__月__日
测试人员：________
测试平台：________
测试结果：通过 / 失败

功能测试：
- 创建备份：✅ / ❌
- 导出备份：✅ / ❌
- 导入备份：✅ / ❌
- 恢复备份：✅ / ❌
- 删除备份：✅ / ❌
- 自动备份：✅ / ❌

异常测试：
- 无效文件：✅ / ❌
- 磁盘不足：✅ / ❌
- 过程中断：✅ / ❌

性能测试：
- 大数据量：✅ / ❌
- 多备份：✅ / ❌

问题记录：
1. ________
2. ________

建议：
1. ________
2. ________
```

## 下一步

测试通过后，可以开始实现 WebDAV 同步功能。
