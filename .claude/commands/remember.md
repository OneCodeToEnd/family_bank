---
description: 记住经验和坑点，自动分类沉淀到 context 目录，供后续需求自动加载
allowed-tools: ["Read", "Write", "Grep", "Glob", "Bash"]
argument-hint: <content-to-remember>
---

# 知识沉淀命令

记住以下内容：$ARGUMENTS

## 命令说明

此命令用于将开发过程中发现的经验、坑点、规范等知识沉淀到 `context/` 目录，后续相关需求开发时会自动加载这些上下文。

## Step 1: 分析内容

分析要记住的内容 `$ARGUMENTS`，确定：

### 1.1 内容类型识别

根据关键词自动识别内容类型：

| 类型 | 触发关键词 | 目标目录 |
|------|-----------|---------|
| 技术规范 | 规范、标准、约定、配置、架构、技术、接口、API | `context/tech/` |
| 经验教训 | 坑、问题、注意、bug、错误、教训、踩坑、异常、失败 | `context/experience/` |
| 业务规则 | 业务、流程、规则、协作、团队、审批、权限 | `context/business/` |

### 1.2 提取关键信息

从内容中提取：
- **标题**：简洁描述核心内容
- **领域**：涉及的技术或业务领域
- **标签**：用于后续检索的关键词
- **严重程度**：高/中/低（针对坑点）

## Step 2: 自动分类

根据分析结果，确定保存位置：

### 技术规范类 → `context/tech/`

适用于：
- 配置规范（Apollo、Nacos、环境变量等）
- 编码标准（命名规范、代码风格等）
- 架构约定（分层规范、模块划分等）
- 技术选型（框架选择、中间件使用等）
- 接口规范（API 设计、协议约定等）

### 经验教训类 → `context/experience/`

适用于：
- 历史坑点（踩过的坑、已知问题）
- 问题解决方案（排查思路、修复方法）
- 注意事项（容易出错的地方）
- 性能优化（性能问题及解决方案）
- 兼容性问题（版本兼容、环境差异）

### 业务规则类 → `context/business/`

适用于：
- 业务流程（审批流程、操作步骤）
- 跨团队协作（对接方式、联系人）
- 业务约束（限制条件、边界规则）
- 权限规则（角色权限、数据权限）
- 合规要求（安全规范、审计要求）

## Step 3: 生成文件名

基于内容生成描述性文件名：

### 命名规则
- 使用中文或英文，保持一致性
- 简洁明了，包含关键信息
- 避免特殊字符，使用连字符分隔
- 长度控制在 50 字符以内

### 命名示例

| 内容 | 生成的文件名 |
|------|-------------|
| Apollo 配置必须提前加载 | `Apollo配置加载规范.md` |
| JWT token 过期处理 | `JWT过期处理注意事项.md` |
| 商品发放接口超时问题 | `商品发放接口超时问题.md` |
| 跨团队数据同步流程 | `跨团队数据同步流程.md` |

## Step 4: 检查是否已存在

检查目标目录是否已存在相似文件：

```bash
# 搜索相似文件
find context/ -name "*.md" | xargs grep -l "<关键词>" 2>/dev/null
```

如果存在相似文件

```markdown

📄 发现相似的已有文档：

1. context/experience/Apollo配置问题.md
   - 创建时间：2024-01-10
   - 内容摘要：Apollo 配置加载顺序问题...

请选择操作：
1. 更新已有文档（追加内容）
2. 创建新文档
3. 取消操作

请输入选项 (1/2/3):
```

如果不存在相似文件

直接创建新文件。

## Step 5: 写入文件

使用以下格式保存文档：

```markdown
# [标题]

> 📌 分类：[技术规范/经验教训/业务规则]
> 🏷️ 标签：[标签1], [标签2], [标签3]
> ⚠️ 严重程度：[高/中/低]（仅坑点类）

## 背景

[问题背景描述]
- 发生场景
- 影响范围
- 发现时间

## 问题描述

[具体问题详细描述]

### 现象
[问题表现]

### 原因
[根本原因分析]

## 解决方案

[解决方法详细说明]

### 推荐做法

[代码示例或配置示例]

### 错误做法

[反面示例]

## 注意事项

- [ ] [注意点1]
- [ ] [注意点2]
- [ ] [注意点3]

## 相关链接

- [相关文档](链接)
- [相关代码](链接)
- [参考资料](链接)

## 影响的服务/模块

- 服务1
- 服务2

## 检查清单

在涉及相关功能时，请确认：

- [ ] 是否已考虑此问题？
- [ ] 是否按照推荐做法实现？
- [ ] 是否已测试相关场景？

---

## 文档元信息

| 属性 | 值 |
|-----|-----|
| 记录时间 | {{current_date}} |
| 来源 | /remember 命令 |
| 最后更新 | {{current_date}} |
| 更新次数 | 1 |

```

## Step 6: 更新索引

更新 context/INDEX.md，添加新文件的引用：

读取当前索引

```bash
cat context/INDEX.md
```

更新索引内容

在对应分类下添加新文件引用：

```markdown
## 最近更新

| 文档 | 分类 | 更新时间 |
|------|------|---------|
| [标题](path/to/file.md) | 经验教训 | {{current_date}} |

## 经验和坑点

### 最新添加
- [标题](experience/filename.md) - {{current_date}}
```


## Step 7: 输出完成摘要

```markdown
✅ 知识已沉淀！

📁 文件信息
   路径: context/[category]/[filename].md
   分类: [技术规范/经验教训/业务规则]
   标签: [tag1], [tag2], [tag3]

📊 内容摘要
   标题: [标题]
   严重程度: [高/中/低]
   影响范围: [服务/模块列表]

🔗 关联信息
   相似文档: [如有]
   关联规则: [如有创建]

💡 后续操作
   - 后续相关需求将自动加载此上下文
   - 使用 @context/[category]/[filename].md 直接引用
   - 使用 /req-dev <需求> 开始需求开发时会自动提醒

📋 验证命令
   cat context/[category]/[filename].md
```